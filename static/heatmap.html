<!doctype html>
<html>
  <head>
    <title>Dublin Bike Parking</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css"
      integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
      crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
      integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
      crossorigin="anonymous">
    <style type="text/css">
      html, body {padding:0;margin:0;height:100%;}

      #map {
        width:100%;
        height:100%;
      }
      .info { padding: 6px 8px; font: 14px/16px Arial, Helvetica, sans-serif; background: white; background: rgba(255,255,255,0.8); box-shadow: 0 0 15px rgba(0,0,0,0.2); border-radius: 5px; } .info h4 { margin: 0 0 5px; color: #777; }
      .legend { text-align: left; line-height: 18px; color: #555; }
      .leaflet-popup-content { text-align: center; }
      .leaflet-selector { position: fixed; top: 0; right: 0; margin-top: 10px; margin-right: 10px; z-index: 9999; }
      .icon-color { color: #148bbb; }
    </style>
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"
      integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
      crossorigin="anonymous"></script>
    <script src="https://unpkg.com/leaflet-hash@0.2.1/leaflet-hash.js"
      integrity="sha384-2V+X2eD8Nz+G+FVKmPS5XkcMt40qrSGaHSoV8Ny7VAvPnHMfnLgrZ6qvNZVJ2ycb"
      crossorigin="anonymous"></script>
    <script src="https://unpkg.com/leaflet-ajax@2.1.0/dist/leaflet.ajax.min.js"
      integrity="sha384-sKs8ZrrxyJoElcPVznZwGpUTTXvkMYfHYxdIFzO8Hd0TA6emONMj8BwnsFf+6cZ/"
      crossorigin="anonymous"></script>
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"
      integrity="sha384-mFKkGiGvT5vo1fEyGCD3hshDdKmW3wzXW/x+fWriYJArD0R3gawT6lMvLboM22c0"
      crossorigin="anonymous"></script>
    <script type="text/javascript">
      window.addEventListener('load', function() {
        var map = L.map('map').setView([53.34587706183283, -6.267379465984959], 12);
        var hash = new L.Hash(map);

        var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Stand Data: <a href="https://bleeperbike.com/">Bleeper Bikes</a>, DublinBikes: <a href="https://developer.jcdecaux.com/#/opendata/vls?page=getstarted&contract=Dublin">JCDecaux</a>',
            maxZoom: 19
        }).addTo(map);

        var heat = L.heatLayer([],{radius:30,blur:30,minOpacity:0.3});
        var standsLayer = new L.GeoJSON.AJAX("/api/v0/stand?dublinbikes=off",{onEachFeature: function(f,l) {
          heat.addLatLng([f.geometry.coordinates[1],f.geometry.coordinates[0],f.properties["numberOfStands"]/10]);
        }});
        heat.addTo(map);

        var hireHeat = L.heatLayer([],{radius:60,blur:60,minOpacity:0.3});
        var hireLayer = new L.GeoJSON.AJAX("/api/v0/stand?dublinbikes=only",{onEachFeature: function(f,l) {
          hireHeat.addLatLng([f.geometry.coordinates[1],f.geometry.coordinates[0],f.properties["numberOfStands"]/40]);
        }});

        document.getElementById("myBikeSelector").addEventListener("click", function(e) {
          hireHeat.remove()
          heat.addTo(map)
          e.target.classList.add("btn-dark")
          e.target.classList.remove("btn-outline-dark")
          document.getElementById("hireBikeSelector").classList.remove("btn-dark")
          document.getElementById("hireBikeSelector").classList.add("btn-outline-dark")
        });
        document.getElementById("hireBikeSelector").addEventListener("click", function(e) {
          heat.remove()
          hireHeat.addTo(map)
          e.target.classList.add("btn-dark")
          e.target.classList.remove("btn-outline-dark")
          document.getElementById("myBikeSelector").classList.remove("btn-dark")
          document.getElementById("myBikeSelector").classList.add("btn-outline-dark")
        });
      })
    </script>
  </head>
  <body>
    <div id="map">
    </div>
    <div class="btn-group leaflet-selector">
      <button type="button" class="btn btn-sm btn-dark" id="myBikeSelector">My Bike</button>
      <button type="button" class="btn btn-sm btn-outline-dark" id="hireBikeSelector">DublinBikes</button>
    </div>
  </body>
</html>
